<!DOCTYPE html>
<html lang="en">
<head>
    <style>
        .container { clear: both; }
        h1 {color: #fcffff;
            text-align:center}
        h2 {color: rgba(62, 62, 62, 0.98);
            background-color: #f8ffff; 
            opacity: 0.95; 
            width: fit-content;
            max-height:100%;
            width:-moz-fit-content;
            text-align: center;}
        body {font: 14px "Segoe UI";
            background: url("http://www.parikiaki.com/wp-content/uploads/parthenon-1.jpg") no-repeat;
            background-size: 200% 100%;
            background-position-x: center;
            background-blend-mode: lighten;
        }
        ol{
        background-color: #d9fffc; 
            opacity: 0.95; 
            width: fit-content;
            width:-moz-fit-content;
            max-height: fit-content;
        }
        p{
            background-color: #d9fffc; 
            opacity: 0.95; 
            width: fit-content;
            width:-moz-fit-content;
            max-height: fit-content;
        }
        div{
            background-color: #d9fffc; opacity: 0.95; width: fit-content;
            width:-moz-fit-content;
            max-height: fit-content;
        }
    </style>
    <meta charset="UTF-8">
</head>

<body>


<!– background alternative "http://www.nationsonline.org/gallery/Monuments/Acropolis-of-Athens.jpg" –>


<h1>Project 2 - Group 17</h1>
<h2 style="width: fit-content">Motivation</h2>
<p>In this assignment we set out to plot temperature data from Athens - since two of the people in the group are Greeks -
    starting in 1920 and ending in 2016, in two different ways in order to see if the types of visualisations
    we use can tell us anything about the data and if they can help us identify any year-long trends. </p>


<h2>Method</h2>
<p>Our data comes from NASA and the Goddard Institute for Space Studies.
    [<a href="https://data.giss.nasa.gov/cgi-bin/gistemp/show_station.cgi?id=618167140000&dt=1&ds=14">1</a>
    <a href="https://data.giss.nasa.gov/tmp/gistemp/STATIONS/tmp_618167140000_14_0/station.txt">2</a>]

    To be able to analyse it we downloaded the above text file and we manually transformed it into a csv file and removed
    lines where the last column had values that were higher than 999 degrees Celsius. Therefore, the years
    that were not included due to "bad" data were the years 1919,1987, 1997, 1998 and 2017.
    The resulting file is inside the repository of this github page under the name "temp.csv". The reason we explicitly
    provide a data-file lies not with the corrupted data alone, but also with the fact that
    the NASA website was denying access to the scripts when they were trying to access the data from outside their
    website and an easy bypass for this was not available to us.

    We, then, used javascript code, which is inserted at the end of the html for this webpage, to plot the data first as a
    line and secondly as a bar-plot(where every year is a single bar).
    Both of them are honest representations of one-dimensional data and minimise bias.
    In both plots the x axis represents years and the y axis represents the average temperature of each of those years in Celsius which is the last column of our data-file.

</p>


<h2>Results</h2>
<div id = "image1"></div>
<p>Figure 1: Line plot of the average temperature in Athens, from 1920 to 2016. Data source: NASA, Station Data: Athinai/Obser (38.0 N,23.7 E)</p>
<div id = "image2"></div>
<p>Figure 2: Barplot of the average temperature in Athens, from 1920 to 2016. Data source: NASA, Station Data: Athinai/Obser (38.0 N,23.7 E)</p>


<h2>Discussion</h2>
<p>As we can see from the plots, the average temperature in Athens has been steadily increasing since the mid-nineties and starting from 1999
     it has always been above 18 degrees C and starting in 2010 the temperatures have been, almost every year, above 19 degrees. 
    It is also interesting to note that, in contrast to the period from 1950 to ~1995, after the temperature increase is notable there are less
    fluctuations(meaning less warm year-cool year shifts), and more high-temperature spikes.</p>

<h2>Conclusions</h2>
<p>In conclusion, the data suggests a steady upward temperature increase in Athens that started in the mid-nineties and has gotten worse 
    in the 2010s. Temperatures above 18 and 19 degrees have become more common and there are few sign of a future decrease in the temperature,
    in the contrary, there seems to be either a new plateau around 18.5C or even a slight linear increase over time. 
    <br /><br /> The line-plot is easier to analyse in comparison to the barplot, something that could improve if we added some interactivity to the barplot
    showing the y values when the mouse hovers over the bars. Another improvement would be to fill the space under the lineplot or juxtapose the two plots or 
    even produce a density plot over the barplot.</p>


<h3  style="background-color: #d9fffc; opacity: 0.95; width: fit-content; width:-moz-fit-content; font-size: 30px;">Individual Replies</h3>

<ol>
<li><h3>Ioannis Chrysostomakis, question 3.1: </h3>To further investigate this question there are several things we can do:
<br /> 1) We can plot more columns from the dataset that we used, like the average seasonal or even monthly temperature,
    in order to see if there are, instead, any seasonal temperature fluctuations that would otherwise be undetectable when 
    taking the average year temperature, which we would expect to show less variation. This would allow us to see if the summers
    and winters,for example, are getting warmer every year.
<br /><br /> 2) Another interesting dataset could come from the National Centers for Environmental Information
    (NOAA)[<a href="https://www.ncdc.noaa.gov/cdo-web/datasets">3</a> ] where we could investigate precipitation, the annual snow index or sea temperature, all of which can and are
    influenced by changes in temperature. So, even if the average temperature does no change drastically when you analyse the average value seasonal or small global temperature changes could be having a
    large effect on the microclimate and ecosystems of the area which would then translate to higher temperatures. Some examples of the plots we could use are:
    <br />
    <img src="https://www.seatemperature.org/public/charts/athens-gr-sml.png">
    <img src="johnchrys.github.io/map.gif " width="400" height="200">
<br /><br /> 3) Another dataset we could also use from environmental organisation is pollution and smog data and cross-reference
    it with temperature data. This will allow us to understand if the perturbations in the data from the previous point
    are due to pollution and not temperature increases and we would also be able to say if spikes in temperature can be
    understood in relation to spikes in air pollution.
<br /><br /> 4) Lastly, we could plot temperature data from the same NASA institute but for more cities and compare them
    with Athens in the form of a multiple line-plots. The reason for this would be to see if the temperature in Athens
    follows a global trend and even if it avoids it, in which case we would have to try to understand why.
<br /><br /> Overall, a combined, well-annotated analysis of all of this data could help us understand the local microclimate and
    to what degree changes in temperature starting in the mid-nineties can be explained by a global trend, pollution or a combination of all.</li>

<li><h3>Elmir Mahammadov, question 3.2: </h3> Instead of one plot with averages of each year, we can use
    streamograph with a button where a button named 'next' could visualise how temperatures changed for each month
    of each year.</li>

<li><h3>Dimitris Chouliaras, question 3.3: </h3> Even though we are able to change the attributes of SVG containers according to the size of the input data, the amount of data may be a prohibitive factor for such visualizations at the end. i.e. in the case where we are visualizing real time data, the size of them may erupt in many times more our initial goal. What if the incoming data suddenly increase five times, and then again? As the data attributes grows bigger and bigger, the same happens to the SVG coordinate space, resulting in coordinates that are out of the view port.
We can always split large datasets or discard data rows/columns with many missing values, since they don’t carry useful information. Setting a missing value threshold will reduce the data accordingly. Similarly, data rows/columns with little change (small variance) across the dataset are discarded due to lack of information.
Filtering the dataset for data points of particular interest is a way to go, however another option is to hire machine learning techniques such as PCA (Principle Component Analysis) and reduce their dimensionality. PCA is a technique that emphasizes variation and makes profound the strong patterns in a dataset. Moreover, the dataset can easily be plotted in 3D, producing stunning results and giving more insight than a simple 2D representation. In the PCA case the human understanding of the meaning of the dimensions extracted is the key to success. 
Apart from being effective classifiers, Random Forests can select important data features. i.e. by generating a large number of shallow trees and training each tree for a small fraction of the overall data features, we can keep the features that are regularly selected as best split. These features will most probably carry the more information of the dataset.
I can’t really propose a cutoff on the size of data for D3 visualization, since dimensionality reduction is an always an option, especially when using the PCA technique. This kind of data preprocessing always gives reasonable amount of information for visualization in the case our initial dataset is too large to be loaded. One example of a large dataset can be the eating habits of all countries around the world, represented by the average consumption of let’s say 20 different commercial food products (which means 20 dimensions). Using PCA we can make a meaningful summary visualization of how similar and different are the countries between each other based on their habits, without the need of presenting the whole the dataset.
A different example of large dataset for visualization is the visualization of live Tweets all over the world. This is a special case of continuously delivered data that can any time erupt based on unpredicted events around the world. The data must be separated in different regions of the word and filter out the less popular among them. Old data are deleted, and new ones take their place constantly. Charts are counting the number of tweets since the user logged in. An SVG container holds the world map.
Our dataset was decreased by removing lines where the last column had values that were higher than 999 degrees Celsius. Therefore, the years that were not included due to "bad" data were the years 1919,1987, 1997, 1998 and 2017.
</li>

</ol>


<p>Disclaimer: Plot 1 was mostly build by us using standard code for building line-plots,
    whereas plot 2 was primarily addapted from the code provided in class.
    <br /></p>


<script src="https://d3js.org/d3.v4.min.js"></script>
<script>


//load data
d3.csv("johnchrys.github.io/temp.csv ",
    function (data) {
        return {
            year: +data.YEAR,
            average: +data.metANN
        };
    },
    function (data) {

        //create the margin, width and height variable that we'll use
        //create the svg object and append it to the appropriate position in the html file
        var margin = {top: 40, right: 50, bottom: 50, left: 50};
        var width = 1000 - margin.left - margin.right;
        var height = 500 - margin.top - margin.bottom;
        var svg1 = d3.select("#image1")
            .append("svg")
            .attr("width", width + margin.left + margin.right)
            .attr("height", height + margin.top + margin.bottom)
            .append("g")
            .attr("transform",
                "translate(" + margin.left + "," + margin.top + ")");

        //scale data
        var x = d3.scaleLinear().rangeRound([0, width]);
        var y = d3.scaleLinear().rangeRound([height, 0]);

        // define the line
        var plotline = d3.line()
            .x(function(d) { return x(d.year); })
            .y(function(d) { return y(d.average); });


        // Range of the data
        x.domain(d3.extent(data, function (d) {
            return d.year;
        }));
        y.domain([0, d3.max(data, function (d) {
            return d.average;
        })]);


        // Add the line path - add color and width
            svg1.append("path")
                .data([data])
                .attr("class", "line")
                .attr("d", plotline)
                .attr("fill","none")
                .attr("stroke","darkblue")
                .attr("stroke-width",2);

            // Add the X Axis and rotate it to see the years
            svg1.append("g")
                .attr("class", "axis x")
                .attr("transform", "translate(0," + height + ")")
                .call(d3.axisBottom(x))
                .selectAll("text")
                .attr("y", 0)
                .attr("x", 9)
                .attr("dy", ".35em")
                .attr("transform", "rotate(80)")
                .style("text-anchor", "start");

            // Add the Y Axis with enough ticks to show all data
            svg1.append("g")
                .attr("class", "axis y")
                .call(d3.axisLeft(y).ticks(21));
            
            
            //make dotted line at 19 degrees - save data in the form that we use to scale and plot
            var data1 = {year:"1920",average:"19"};
            var data2 = {year:"2016",average:"19"};

            //append a line and choose a style
            svg1.append("line")
                .attr("x1",x(data1.year))
                .attr("x2",x(data2.year))
                .attr("y1",y(data1.average))
                .attr("y2",y(data2.average))
                .style("stroke-dasharray",("7, 7")) //friends reference
                .style("stroke","black");

            //make new dotted line at 17 degrees - save data in the form that we use to scale and plot
            var data3 = {year:"1920",average:"17"};
            var data4 = {year:"2016",average:"17"};

            //append a line and choose a style
            svg1.append("line")
                .attr("x1",x(data3.year))
                .attr("x2",x(data4.year))
                .attr("y1",y(data3.average))
                .attr("y2",y(data4.average))
                .style("stroke-dasharray",("7, 7"))
                .style("stroke","black");

    });


</script>

<script>

    //load data
d3.csv("johnchrys.github.io/temp.csv ",
    function (data) {
        return{
            year : +data.YEAR,
            average : +data.metANN};
    },
    function (data){
        //create the margin, width and height variable that we'll use
        //create the svg object and append it to the appropriate position in the html file
        var margin = {top: 40, right: 50, bottom: 50, left: 50};
        var width = 1000 - margin.left - margin.right;
        var height = 500 - margin.top - margin.bottom;

        var svg2 = d3.select("#image2")
            .append("svg")
            .attr("width", width + margin.left + margin.right)
            .attr("height", height + margin.top + margin.bottom)
            .append("g")
            .attr("transform",
                "translate(" + margin.left + "," + margin.top + ")");


        //scale data
        var x = d3.scaleBand().rangeRound([0, width])
            .padding(0.15)
            .domain(data.map(function(data) { return data.year; }));

        var y = d3.scaleLinear().rangeRound([height, 0])
            .domain([0, d3.max(data, function(data) { return data.average; })]);

        //add x axis
        svg2.append("g")
            .attr("class", "axis x")
            .attr("transform", "translate(0," + height + ")")
            .call(d3.axisBottom(x))
            .selectAll("text")
            .attr("y", 0)
            .attr("x", 9)
            .attr("dy", ".35em")
            .attr("transform", "rotate(80)")
            .style("text-anchor", "start");

        //add y axis
        svg2.append("g")
            .attr("class", "axis y")
            .call(d3.axisLeft(y).ticks(21));

        //make barplot
        svg2.selectAll(".bar")
            .data(data)
            .enter().append("rect")
            .attr("x", function(data) { return x(data.year); })
            .attr("y", function(data) { return y(data.average); })
            .attr("width", x.bandwidth())
            .attr("height", function(data) { return height - y(data.average); })
            .attr("fill","steelblue");
    
            //make dotted line at 19 degrees - save data in the form that we use to scale and plot
            var data1 = {year:0,average:"19"};
            var data2 = {year:width,average:"19"};

            //append a line and choose a style
            svg2.append("line")
                .attr("x1",x(data1.year))
                .attr("x2",(data2.year))
                .attr("y1",y(data1.average))
                .attr("y2",y(data2.average))
                .style("stroke-dasharray",("7, 7")) //friends reference
                .style("stroke","black");

            });


</script>

</body>
</html>
