<!DOCTYPE html>
<html>
<head>
    <script src='https://api.mapbox.com/mapbox-gl-js/v0.42.0/mapbox-gl.js'></script>
    <link href='https://api.mapbox.com/mapbox-gl-js/v0.42.0/mapbox-gl.css' rel='stylesheet' />
    <style>
        body { margin:15px; padding:15px; }
        #map { position:relative; top:15px; bottom:15px; width:100%; }
        #menu {
            background: #fff;
            position: relative;
            z-index: 1;
            left: 450px;
            top: 10px;
            border-radius: 3px;
            width: 120px;
            border: 1px solid rgba(0,0,0,0.4);
            font-family: 'Open Sans', sans-serif;
        }

        #menu a {
            font-size: 13px;
            color: #404040;
            display: block;
            margin: 0;
            padding: 10px;
            text-decoration: none;
            border-bottom: 1px solid rgba(0,0,0,0.25);
            text-align: center;
        }

        #menu a:last-child {
            border: none;
        }

        #menu a:hover {
            background-color: #f8f8f8;
            color: #404040;
        }

        #menu a.active {
            background-color: #3887be;
            color: #ffffff;
        }

        #menu a.active:hover {
            background: #3074a4;
        }
        .map-overlay {
            position: absolute;
            bottom: 0;
            right: 0;
            background: rgba(255, 255, 255, 0.8);
            margin-right: 20px;
            font-family: Arial, sans-serif;
            overflow: auto;
            border-radius: 3px;
        }

        #features {
            top: 0;
            height: 100px;
            margin-top: 20px;
            width: 250px;
        }

        #legend {
            padding: 10px;
            box-shadow: 0 1px 2px rgba(0, 0, 0, 0.1);
            line-height: 18px;
            height: 150px;
            margin-bottom: 40px;
            width: 100px;
        }

        .legend-key {
            display: inline-block;
            border-radius: 20%;
            width: 10px;
            height: 10px;
            margin-right: 5px;
        }


    </style>

</head>

<body>
<pre id='info'></pre>
<div id='map' style='width: 1000px; height: 500px;'></div>
<nav id="menu"></nav>
<div class='map-overlay' id='features'><h2>Crime in LA</h2><div id='pd'><p>Click a button to choose a dataset or hover over the map for the coordinates!</p></div></div>
<div class='map-overlay' id='legend'></div>

<script>
    mapboxgl.accessToken = 'pk.eyJ1IjoiZWxtaXJhY2xlIiwiYSI6ImNqYnRzMHZvaDF1OTYyeG05ODYzeG0xcjMifQ.46vT-JIIIOygrEn8SOZr1g';
    var map = new mapboxgl.Map({
        container: 'map',
        style: 'mapbox://styles/mapbox/dark-v9',
        center: [-122.427489,37.767831],
        zoom: 11.38

    });
    map.on('load', function() {
        map.addLayer({
            'id': 'Weekday vs. Weekend',
            'type': 'circle',
            'source': {
                type: 'vector',
                url: 'mapbox://elmiracle.36uqjrui'
            },
            'source-layer': 'crime-6v0rnn',
            'layout': {
                'visibility': 'none'
            },
            'paint': {
                // make circles larger as the user zooms from z12 to z22
                'circle-radius': {
                    'base': 1.75,
                    'stops': [[12, 2], [22, 180]]
                },
                'circle-color': {
                    property: 'DayOfWeek',
                    type: 'categorical',
                    stops: [
                        ['Monday', '#3bb2d0'],
                        ['Tuesday', '#3bb2d0'],
                        ['Wednesday', '#3bb2d0'],
                        ['Thursday', '#3bb2d0'],
                        ['Friday', '#3bb2d0'],
                        ['Saturday', '#ff8c00'],
                        ['Sunday','#ff8c00']]
                }
            }
        });
        map.addLayer({
            'id': 'Crime Category',
            'type': 'circle',
            'source': {
                type: 'vector',
                url: 'mapbox://elmiracle.36uqjrui'
            },
            'source-layer': 'crime-6v0rnn',
            'layout': {
                'visibility': 'none'
            },
            'paint': {
                // make circles larger as the user zooms from z12 to z22
                'circle-radius': {
                    'base': 2,
                    'stops': [[12, 2.5], [22, 180]]
                },
                'circle-color': {
                    property: 'Category',
                    type: 'categorical',
                    stops: [
                        ['ASSAULT', '#e2ffaf'],  //Yellow, Assault
                        ['BURGLARY','#c43235'],  //Red, Burglary
                        ['VANDALISM', '#0DD91C'], //Green,  Vandalism
                        ['LARCENY\/THEFT','#FFFFFF']] //white, larceny theft
                }
            }
        });

        var layers = ["Week day", "Weekend", 'Assault', 'Burglary', 'Vandalism','Larceny/Theft', 'All others'];

        var colors = ['#3bb2d0', '#ff8c00', '#e2ffaf', '#c43235', '#0DD91C', '#FFFFFF', '#000000'];



        for (i = 0; i < layers.length; i++) {
            var layer = layers[i];
            var color = colors[i];
            var item = document.createElement('div');
            var key = document.createElement('span');
            key.className = 'legend-key';
            key.style.backgroundColor = color;

            var value = document.createElement('span');
            value.innerHTML = layer;
            item.appendChild(key);
            item.appendChild(value);
            legend.appendChild(item);
        }




        map.on('mousemove', function (e) {
            document.getElementById('info').innerHTML =
                // e.point is the x, y coordinates of the mousemove event relative
                // to the top-left corner of the map
                JSON.stringify(e.point) + '<br />' +
                // e.lngLat is the longitude, latitude geographical position of the event
                JSON.stringify(e.lngLat);
        });
        map.addControl(new mapboxgl.FullscreenControl());

    });


    var toggleableLayerIds = [ 'Weekday vs. Weekend', 'Crime Category' ];

    for (var i = 0; i < toggleableLayerIds.length; i++) {
        var id = toggleableLayerIds[i];

        var link = document.createElement('a');
        link.href = '#';
        link.className = '';
        link.textContent = id;

        link.onclick = function (e) {
            var clickedLayer = this.textContent;
            e.stopPropagation();

            var visibility = map.getLayoutProperty(clickedLayer, 'visibility');

            if (visibility === 'visible') {
                map.setLayoutProperty(clickedLayer, 'visibility', 'none');
                this.className = '';
            } else {
                this.className = 'active';
                map.setLayoutProperty(clickedLayer, 'visibility', 'visible');
            }
        };

        var layers = document.getElementById('menu');
        layers.appendChild(link);
    }

</script>


</body>
</html>
